\chapter{Pruebas de integración y fiabilidad}

El eje fundamental de este capítulo es mostrar el rendimiento del sistema en diferentes circunstancias, y probar que el mismo es capaz de desenvolverse de forma satisfactoria en la mayoría de escenarios posibles.

\section{Prueba de exterior}

Esta prueba se realizó con una cámara Kanon [Incluir data de la camara, es del santi] en el estacionamiento de la Facultad de Ingeniería de la Universidad Nacional del Comahue entre las 8 y 9 de la mañana, el martes 6 de junio del 2023. La prueba se realizó colocando la cámara en un trípode con una altura de 70cm respecto del suelo, y se procedió a filmar los vehículos que entraban en el estacionamiento o pasaban por la calle interna de la universidad. De este proceso de medición se obtuvieron dos videos de una duración aproximada de 40min.

Teniendo en cuenta que el algoritmo de OCR tarda 1200ms en procesar un frame es necesario realizar un filtrado, ya que los 40min de filmación equivalen en 72000 imágenes, y la mayoría no poseen vehículos o la patente no está enfocada.
El proceso de filtrado consistió en un recorte manual de las partes donde no había ningún vehículo, lo que terminó dejando 7min de filmación. Si bien este número es bajo, llevó a obtener un total de 35 vehículos, suficientes para el análisis. Posteriormente se convirtió el video en frames, utilizando Open CV, para luego procesar las 11000 fotografías y eliminar las que no era posible reconocer la patente del vehículo. Luego se obtuvieron 3600 fotografías válidas, que se procesaron por el algoritmo de OCR y se descartaron todas las imágenes con porcentaje de seguridad inferior al $50\%$.
Las imágenes se clasificaron en una carpeta con el valor predicho por el algoritmo.
Finalmente se contabilizaron los errores generando el resumen de Tab. \ref{tab:resumen-patente}.

\begin{table}
    \centering
    \input{chapters/06-pruebas/plate-resume-table.tex}
    \caption{Resumen de las patentes reconocidas.}
    \label{tab:resumen-patente}
\end{table}

\subsection{Análisis de resultados}

De esta prueba se observa que el rendimiento del algoritmo ronda el $49\%$ de aciertos, que se considera bajo.
Sin embargo, se debe considerar que el sistema está diseñado para vehículos que tienen que detenerse frente a una barrera y esperar que la misma se active, o no, luego de reconocer la patente. Como las fotografías procesadas se obtuvieron a partir de autos en movimiento, se espera que el porcentaje de aciertos mejore si la captura se realiza con el vehículo detenido.

\section{Pruebas de distancia y ángulo}

Para realizar esta serie de pruebas se colocó un Volkswagen Up modelo 2015 con patente PEY232 en una posición fija y se procedió a medir con una cinta métrica de error 1cm. El ángulo de $0^\circ$ corresponde al centro de la patente, mientras que el origen se tomó desde el centro de la misma.
En Fig. \ref{fig:sistema-medicion-angulos} se puede apreciar un esquema del sistema de ejes. La medición consistió en la captura de una fotografía con la cámara de los sistemas SL a una distancia y ángulo determinados. Luego, cada medición se procesó con el algoritmo de OCR.
Debido al espacio con el que se contaba, se realizaron dos pruebas: la primera consistio en fijar el angulo en $0^\circ$ e ir tomando muestras cada 50cm, mientras que en la segunda se fijo la distancia en 50cm y se vario el ángulo cada $30^\circ$.
Las muestras obtenidas para la primera prueba pueden verse en la Fig. \ref{fig:fotos-distancia} y los resultados obtenidos en la Tab. \ref{tab:resumen-distancia}, mientras que para la segunda prueba las muestras se observan en la Fig. \ref{fig:fotos-angulo} y los resultados en la Tab. \ref{tab:resumen-angulo}.


\begin{figure}[bth]
    \centering
    \includegraphics[width=.3\textwidth]{imgs/sistema-referencia.png}
    \caption{Sistema de referencia.}
    \label{fig:sistema-medicion-angulos}
\end{figure}

\begin{table}
    \centering
    \input{chapters/06-pruebas/resume_distance}
    \caption{Resumen de la prueba de distancia.}
    \label{tab:resumen-distancia}
\end{table}

\begin{table}
    \centering
    \input{chapters/06-pruebas/resume_angle}
    \caption{Resumen de la prueba de ángulos.}
    \label{tab:resumen-angulo}
\end{table}

\begin{figure}[bth]
    \centering
    \begin{subfigure}{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{imgs/test-distancia/0_50.jpg}
        \caption{50cm}
    \end{subfigure}
    \begin{subfigure}{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{imgs/test-distancia/0_100.jpg}
        \caption{100cm}
    \end{subfigure}
    \begin{subfigure}{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{imgs/test-distancia/0_150.jpg}
        \caption{150cm}
    \end{subfigure}
    \begin{subfigure}{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{imgs/test-distancia/0_200.jpg}
        \caption{200cm}
    \end{subfigure}
    \begin{subfigure}{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{imgs/test-distancia/0_250.jpg}
        \caption{250cm}
    \end{subfigure}
    \begin{subfigure}{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{imgs/test-distancia/0_300.jpg}
        \caption{300cm}
    \end{subfigure}
    \caption{Fotografías a diferentes distancias.}
    \label{fig:fotos-distancia}
\end{figure}

\begin{figure}[bth]
    \centering
    \begin{subfigure}{.15\textwidth}
        \centering
        \includegraphics[width=\textwidth]{imgs/test-angulos/-60_50.jpg}
        \caption{$-60^\circ$}
    \end{subfigure}
    \begin{subfigure}{.15\textwidth}
        \centering
        \includegraphics[width=\textwidth]{imgs/test-angulos/-30_50.jpg}
        \caption{$-30^\circ$}
    \end{subfigure}
    \begin{subfigure}{.15\textwidth}
        \centering
        \includegraphics[width=\textwidth]{imgs/test-angulos/0_50.jpg}
        \caption{$0^\circ$}
    \end{subfigure}
    \begin{subfigure}{.15\textwidth}
        \centering
        \includegraphics[width=\textwidth]{imgs/test-angulos/30_50.jpg}
        \caption{$30^\circ$}
    \end{subfigure}
    \begin{subfigure}{.15\textwidth}
        \centering
        \includegraphics[width=\textwidth]{imgs/test-angulos/60_50.jpg}
        \caption{$60^\circ$}
    \end{subfigure}
    \caption{Fotografías a diferentes ángulos.}
    \label{fig:fotos-angulo}
\end{figure}

\subsection{Análisis de resultados}

Con esta prueba se logró probar el sistema en diferentes distancias y ángulos obteniendo un resultado satisfactorio en todas las pruebas, probando que el sistema funciona de forma correcta en un entorno controlado.

\section{Pruebas sobre el servidor}

\subsection{Integración de los sistemas SL y servidor}

Se montó un sistema SL junto con una notebook como servidor [fig del garage con el auto] y se crearon registros de entrada, y cambio la configuración de un sistema SL en tiempo real. Con esta prueba se logró probar los cambios de configuración en tiempo real y que los registros se creen de forma correcta.

\subsection{Creación de registros}

Para probar el correcto de funcionamiento del servidor, se creó un usuario de admin y un cliente. Se crearon dos lugares junto con un script en Python 3 emulando el envío de datos de las barreras, generando en el servidor 5900 registros para los lugares, probando el funcionamiento del sistema de inicio a fin.




